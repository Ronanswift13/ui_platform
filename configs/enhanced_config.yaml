# 全自动AI巡检增强配置
# 输变电激光监测平台 - 改造方案

# ============== 深度学习推理配置 ==============
inference:
  # 默认后端
  default_backend: onnx_cpu  # onnx_cpu, onnx_cuda, tensorrt
  
  # GPU配置
  cuda:
    enabled: true
    device_id: 0
    fp16: true
    
  # TensorRT配置
  tensorrt:
    enabled: false
    workspace_size_mb: 1024
    precision: fp16  # fp32, fp16, int8
    
  # 批处理
  batch_size: 1
  max_batch_size: 4
  
  # 超时
  timeout_ms: 5000

# ============== 模型注册配置 ==============
models:
  # A组 - 主变巡视
  transformer_defect_yolov8:
    path: models/transformer/defect_yolov8n.onnx
    type: detection
    input_size: [640, 640]
    classes: [oil_leak, rust, damage, foreign_object]
    confidence_threshold: 0.5
    nms_threshold: 0.4
    
  transformer_thermal_cnn:
    path: models/transformer/thermal_anomaly.onnx
    type: classification
    input_size: [224, 224]
    classes: [normal, warning, alarm]
    
  # B组 - 开关间隔
  switch_multitask_yolov8:
    path: models/switch/multitask_yolov8s.onnx
    type: detection
    input_size: [640, 640]
    classes: [breaker_open, breaker_closed, isolator_open, isolator_closed, indicator_red, indicator_green]
    
  switch_ocr_crnn:
    path: models/switch/ocr_crnn.onnx
    type: ocr
    input_size: [32, 128]
    
  # C组 - 母线巡视
  busbar_yolov8m_small:
    path: models/busbar/yolov8m_small_target.onnx
    type: detection
    input_size: [1280, 1280]
    classes: [pin_missing, crack, foreign, corrosion, flashover, broken_strand]
    confidence_threshold: 0.4
    
  # D组 - 电容器
  capacitor_yolov8:
    path: models/capacitor/capacitor_detector.onnx
    type: detection
    input_size: [640, 640]
    classes: [capacitor_unit, tilt, collapse]
    
  intrusion_rtdetr:
    path: models/capacitor/rtdetr_intrusion.onnx
    type: detection
    input_size: [640, 640]
    classes: [person, vehicle, animal]
    
  # E组 - 表计读数
  meter_keypoint_hrnet:
    path: models/meter/hrnet_keypoint.onnx
    type: keypoint
    input_size: [256, 256]
    keypoints: [center, scale_min, scale_max, pointer_tip, pointer_base]
    
  digital_ocr_crnn:
    path: models/meter/digital_ocr.onnx
    type: ocr
    input_size: [32, 128]

# ============== 自动ROI配置 ==============
auto_roi:
  enabled: true
  
  # 检测模型
  detector_model: device_detector_yolov8
  
  # 缓存
  cache_enabled: true
  cache_ttl_seconds: 300
  
  # 跟踪
  tracking_enabled: true
  iou_threshold: 0.5
  max_age: 30

# ============== 多证据融合配置 ==============
fusion:
  # 默认方法
  default_method: weighted_vote  # weighted_vote, bayesian, dempster_shafer
  
  # 默认权重
  weights:
    deep_learning: 0.5
    ocr_text: 0.3
    color_detection: 0.2
    angle_detection: 0.2
    template_match: 0.3
    rule_based: 0.4
    thermal: 0.3
    historical: 0.1
    
  # 冲突解决
  conflict_strategy: weighted_vote  # weighted_vote, max_confidence, consensus
  
  # 置信度校准
  calibration:
    enabled: true
    method: platt_scaling

# ============== 云台控制配置 ==============
ptz:
  # 适配器类型
  adapter: simulated  # simulated, onvif, pelco_d
  
  # ONVIF配置
  onvif:
    host: 192.168.1.100
    port: 80
    username: admin
    password: admin123
    
  # 预置位
  presets:
    - id: 1
      name: 主变全景
      pan: 0
      tilt: 0
      zoom: 1.0
    - id: 2
      name: 开关间隔
      pan: 90
      tilt: -10
      zoom: 2.0
    - id: 3
      name: 母线区域
      pan: 180
      tilt: 20
      zoom: 3.0
      
  # 巡航路线
  patrol_routes:
    - id: default
      name: 默认巡航
      presets: [1, 2, 3]
      dwell_times: [10, 15, 20]
      speed: 1.0
      loop: true
      
  # 复拍配置
  reshoot:
    max_retries: 3
    clarity_threshold: 0.7
    zoom_factor: 1.5
    adjust_focus: true

# ============== 质量门禁配置 ==============
quality_gate:
  enabled: true
  
  # 亮度阈值
  brightness_threshold_high: 200
  brightness_threshold_low: 50
  
  # 清晰度阈值
  laplacian_threshold: 100
  
  # 对比度阈值
  contrast_threshold: 30
  
  # 边缘密度阈值
  edge_density_min: 0.05

# ============== 告警配置 ==============
alarm:
  # 告警级别
  levels:
    info:
      notify: false
      log: true
    warning:
      notify: true
      log: true
      channels: [email]
    error:
      notify: true
      log: true
      channels: [email, sms]
    critical:
      notify: true
      log: true
      channels: [email, sms, scada]
      
  # 入侵告警
  intrusion:
    person_delay: 2.0
    vehicle_delay: 3.0
    animal_delay: 5.0
    
  # 温度告警
  thermal:
    warning_threshold: 60
    error_threshold: 80
    critical_threshold: 100

# ============== 任务调度配置 ==============
scheduler:
  # 自动巡检
  auto_inspection:
    enabled: true
    cron: "0 */4 * * *"  # 每4小时
    
  # 任务超时
  task_timeout: 300
  
  # 并发限制
  max_concurrent_tasks: 4
  
  # 重试策略
  retry:
    max_retries: 3
    delay: 5

# ============== 证据链配置 ==============
evidence:
  base_dir: evidence
  
  # 保存选项
  save_raw: true
  save_annotated: true
  save_thermal: true
  
  # 压缩
  compression: gzip
  
  # 保留时间
  retention_days: 90
