# =============================================================================
# 破夜绘明激光监测平台 - 多电压等级训练数据配置
# 训练路径: /Users/ronan/Desktop/破夜绘明激光监测平台/training
# =============================================================================

# 基础路径配置
paths:
  base_training_path: "/Users/ronan/Desktop/破夜绘明激光监测平台/training"
  checkpoints_path: "${base_training_path}/checkpoints"
  data_path: "${base_training_path}/data"
  exports_path: "${base_training_path}/exports"
  logs_path: "${base_training_path}/logs"
  results_path: "${base_training_path}/results"

# =============================================================================
# 公开数据集来源配置
# =============================================================================
public_datasets:
  # 绝缘子缺陷检测数据集
  insulator_defect:
    name: "Insulator-Defect Detection Dataset"
    source: "datasetninja"
    url: "https://datasetninja.com/insulator-defect-detection"
    github: "https://github.com/InsulatorData/InsulatorDataSet"
    figshare: "https://doi.org/10.6084/m9.figshare.26409637"
    size: "2.43GB"
    images: 1600
    classes: ["insulator", "damaged", "flashover"]
    format: "Supervisely/YOLO"
    voltage_levels: ["500kV", "330kV", "220kV", "110kV"]
    applicable_plugins: ["busbar", "transformer"]
    
  # 中国电力线绝缘子数据集 (CPLID)
  cplid:
    name: "Chinese Power Line Insulator Dataset"
    source: "State Grid Corporation of China"
    github: "https://github.com/InsulatorData/InsulatorDataSet"
    images: 848  # 600 normal + 248 defective
    classes: ["normal_insulator", "defective_insulator"]
    format: "YOLO"
    voltage_levels: ["all"]
    applicable_plugins: ["busbar"]
    
  # 统一公开绝缘子数据集 (UPID)
  upid:
    name: "Unifying Public Insulator Dataset"
    source: "Research augmentation of CPLID"
    github: "https://github.com/phd-benel/MPID"
    images: 6860
    classes: ["insulator", "damaged", "flashover", "hammer"]
    format: "YOLO"
    voltage_levels: ["all"]
    applicable_plugins: ["busbar"]
    
  # IEEE绝缘子缺陷数据集 (IDID)
  idid:
    name: "Insulator Defect Image Dataset"
    source: "IEEE DataPort / Electric Power Research Institute"
    url: "https://ieee-dataport.org/competitions/insulator-defect-detection"
    images: 1600
    classes: ["good", "broken", "flashed", "insulator_string"]
    format: "YOLO"
    voltage_levels: ["110kV", "220kV", "500kV"]
    applicable_plugins: ["busbar", "transformer"]
    
  # 电力设备红外热像数据集
  ir_power_equipment:
    name: "Power Equipment Infrared Image Dataset"
    source: "Northeast Electric Power University"
    images: 2560
    classes: ["lightning_arrester", "transformer", "switch", "reactor", 
              "current_transformer_1", "current_transformer_2", 
              "voltage_transformer", "discharge_coil", "insulator", "fuse"]
    format: "VOC"
    voltage_levels: ["220kV", "500kV"]
    applicable_plugins: ["transformer", "switch", "meter"]
    
  # 变压器热像数据集
  transformer_thermal:
    name: "Thermal Images Dataset - Transformer"
    source: "Mendeley Data"
    url: "https://data.mendeley.com/datasets/8mg8mkc7k5/3"
    images: 255
    classes: ["healthy", "fault_type_1", "fault_type_2", "fault_type_3",
              "fault_type_4", "fault_type_5", "fault_type_6", "fault_type_7", "fault_type_8"]
    format: "Images"
    voltage_levels: ["all"]
    applicable_plugins: ["transformer"]
    
  # 高压设备红外数据集
  hv_ir_dataset:
    name: "Infrared Thermal Image Dataset of High Voltage Equipment"
    source: "SciDB"
    url: "https://www.scidb.cn/en/detail?dataSetId=e416c488169f484485ad7575dcfc43ce"
    classes: ["circuit_breaker", "power_transformer", "surge_arrester", 
              "disconnector", "wave_trap"]
    format: "FLIR Images"
    voltage_levels: ["132kV", "220kV"]
    applicable_plugins: ["transformer", "switch"]
    
  # 电表读数数据集
  ufpr_amr:
    name: "UFPR-AMR Dataset"
    source: "Federal University of Paraná"
    url: "https://arxiv.org/abs/1902.09600"
    github: "https://github.com/raysonlaroca/ufpr-amr-dataset"
    images: 2000
    classes: ["counter", "digit_0", "digit_1", "digit_2", "digit_3", 
              "digit_4", "digit_5", "digit_6", "digit_7", "digit_8", "digit_9"]
    format: "YOLO"
    voltage_levels: ["all"]
    applicable_plugins: ["meter"]
    
  # Copel电表数据集
  copel_amr:
    name: "Copel-AMR Dataset"
    source: "Energy Company of Paraná"
    github: "https://github.com/raysonlaroca/copel-amr-dataset"
    images: 12500
    classes: ["meter_counter", "digits"]
    format: "YOLO"
    voltage_levels: ["all"]
    applicable_plugins: ["meter"]
    
  # 变电站设备缺陷数据集
  substation_defect:
    name: "Substation Equipment Defect Dataset"
    source: "State Grid Shandong Electric Power Company"
    reference: "https://www.mdpi.com/1424-8220/24/18/5914"
    images: 12968
    classes: ["damaged_meter", "oil_leakage", "damaged_breather", 
              "cracked_insulator", "floating_object", "abnormal_door",
              "silicone_discoloration", "rust", "bird_nest", 
              "floor_oil_pollution", "shell_breakage", "broken_cover"]
    format: "YOLO"
    voltage_levels: ["220kV", "500kV"]
    applicable_plugins: ["transformer", "switch", "meter", "capacitor"]

# =============================================================================
# 电压等级训练配置
# =============================================================================
voltage_levels:
  # 特高压 (UHV)
  UHV_1000kV_AC:
    name: "1000kV交流特高压"
    category: "UHV"
    plugins:
      transformer:
        detection_classes:
          - "oil_leak"
          - "rust"
          - "surface_damage"
          - "foreign_object"
          - "silica_gel_normal"
          - "silica_gel_abnormal"
          - "oil_level_normal"
          - "oil_level_abnormal"
          - "bushing_crack"
          - "porcelain_contamination"
          - "partial_discharge"
          - "core_ground_current"
          - "winding_deformation"
        thermal_thresholds:
          normal: 70
          warning: 85
          alarm: 100
        data_sources:
          public: ["transformer_thermal", "ir_power_equipment"]
          placeholder_required: true
          placeholder_reason: "特高压主变容量大(1000-3000MVA)，公开数据极少，需现场采集"
          
      switch:
        detection_classes:
          - "breaker_open"
          - "breaker_closed"
          - "isolator_open"
          - "isolator_closed"
          - "grounding_open"
          - "grounding_closed"
          - "indicator_red"
          - "indicator_green"
          - "gis_position"
          - "gis_sf6_density"
        angle_reference:
          breaker: {open_deg: -65, closed_deg: 35}
          isolator: {open_deg: -75, closed_deg: 25}
          grounding: {open_deg: -85, closed_deg: 15}
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "特高压GIS动作视频和角度标定数据需现场采集"
          
      busbar:
        detection_classes:
          - "insulator_crack"
          - "insulator_dirty"
          - "insulator_flashover"
          - "fitting_loose"
          - "fitting_rust"
          - "wire_damage"
          - "foreign_object"
          - "bird"
          - "pin_missing"
          - "spacer_damage"
          - "corona_discharge"
        data_sources:
          public: ["insulator_defect", "cplid", "upid", "idid"]
          placeholder_required: true
          placeholder_reason: "特高压母线跨度大，需无人机或远距摄像机现场采集"
          
      capacitor:
        detection_classes:
          - "capacitor_unit"
          - "capacitor_tilted"
          - "capacitor_fallen"
          - "capacitor_missing"
          - "person"
          - "vehicle"
          - "fuse_blown"
          - "silver_contact_damage"
        data_sources:
          public: []
          placeholder_required: true
          placeholder_reason: "特高压电容器样本极少，需现场拍摄各缺陷状态"
          
      meter:
        detection_classes:
          - "sf6_pressure_gauge"
          - "sf6_density_relay"
          - "oil_temp_gauge"
          - "oil_level_gauge"
          - "gas_relay"
          - "digital_display"
          - "pointer_gauge"
        data_sources:
          public: ["ufpr_amr", "copel_amr"]
          placeholder_required: true
          placeholder_reason: "特定型号仪表外观差异大，需站内拍摄样本微调"

  UHV_800kV_DC:
    name: "±800kV直流特高压"
    category: "UHV"
    plugins:
      transformer:
        detection_classes:
          - "converter_transformer"
          - "oil_leak"
          - "bushing_crack"
          - "cooling_system"
          - "tap_changer"
        thermal_thresholds:
          normal: 70
          warning: 85
          alarm: 100
        data_sources:
          public: ["transformer_thermal"]
          placeholder_required: true
          placeholder_reason: "换流变压器专用数据需现场采集"
          
      switch:
        detection_classes:
          - "converter_valve"
          - "thyristor_status"
          - "cooling_water"
          - "valve_temperature"
          - "dc_breaker"
        data_sources:
          public: []
          placeholder_required: true
          placeholder_reason: "换流阀监测数据需现场采集"

  # 超高压 (EHV)
  EHV_500kV:
    name: "500kV超高压"
    category: "EHV"
    plugins:
      transformer:
        detection_classes:
          - "oil_leak"
          - "rust"
          - "surface_damage"
          - "foreign_object"
          - "silica_gel_normal"
          - "silica_gel_abnormal"
          - "oil_level_normal"
          - "oil_level_abnormal"
          - "bushing_crack"
          - "porcelain_contamination"
        thermal_thresholds:
          normal: 65
          warning: 80
          alarm: 95
        data_sources:
          public: ["transformer_thermal", "ir_power_equipment", "substation_defect"]
          placeholder_required: false
          
      switch:
        detection_classes:
          - "breaker_open"
          - "breaker_closed"
          - "isolator_open"
          - "isolator_closed"
          - "grounding_open"
          - "grounding_closed"
          - "indicator_red"
          - "indicator_green"
          - "gis_position"
        angle_reference:
          breaker: {open_deg: -60, closed_deg: 30}
          isolator: {open_deg: -70, closed_deg: 20}
          grounding: {open_deg: -80, closed_deg: 10}
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "GIS位置指示符号数据稀少"
          
      busbar:
        detection_classes:
          - "insulator_crack"
          - "insulator_dirty"
          - "insulator_flashover"
          - "fitting_loose"
          - "fitting_rust"
          - "wire_damage"
          - "foreign_object"
          - "bird"
          - "pin_missing"
          - "spacer_damage"
        data_sources:
          public: ["insulator_defect", "cplid", "upid", "idid"]
          placeholder_required: true
          placeholder_reason: "闪络痕迹和间隔棒损坏样本少"
          
      capacitor:
        detection_classes:
          - "capacitor_unit"
          - "capacitor_tilted"
          - "capacitor_fallen"
          - "capacitor_missing"
          - "person"
          - "vehicle"
          - "fuse_blown"
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "熔断/倾斜场景需现场采集"
          
      meter:
        detection_classes:
          - "sf6_pressure_gauge"
          - "sf6_density_relay"
          - "gas_relay"
          - "oil_temp_gauge"
          - "oil_level_gauge"
        data_sources:
          public: ["ufpr_amr", "copel_amr"]
          placeholder_required: true
          placeholder_reason: "特定品牌密度继电器样本较少"

  EHV_330kV:
    name: "330kV超高压"
    category: "EHV"
    plugins:
      transformer:
        detection_classes:
          - "oil_leak"
          - "rust"
          - "surface_damage"
          - "silica_gel_normal"
          - "silica_gel_abnormal"
          - "oil_level_normal"
          - "oil_level_abnormal"
        thermal_thresholds:
          normal: 63
          warning: 78
          alarm: 92
        data_sources:
          public: ["transformer_thermal", "ir_power_equipment"]
          placeholder_required: false
          
      switch:
        detection_classes:
          - "breaker_open"
          - "breaker_closed"
          - "isolator_open"
          - "isolator_closed"
          - "grounding_open"
          - "grounding_closed"
          - "indicator_red"
          - "indicator_green"
        angle_reference:
          breaker: {open_deg: -58, closed_deg: 32}
          isolator: {open_deg: -68, closed_deg: 22}
          grounding: {open_deg: -78, closed_deg: 12}
        data_sources:
          public: ["substation_defect"]
          placeholder_required: false
          
      busbar:
        detection_classes:
          - "insulator_crack"
          - "insulator_dirty"
          - "fitting_loose"
          - "fitting_rust"
          - "wire_damage"
          - "foreign_object"
          - "bird"
        data_sources:
          public: ["insulator_defect", "cplid", "upid"]
          placeholder_required: false
          
      capacitor:
        detection_classes:
          - "capacitor_unit"
          - "capacitor_tilted"
          - "capacitor_fallen"
          - "fuse_blown"
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          
      meter:
        detection_classes:
          - "sf6_pressure_gauge"
          - "oil_temp_gauge"
          - "oil_level_gauge"
        data_sources:
          public: ["ufpr_amr"]
          placeholder_required: false

  # 高压 (HV)
  HV_220kV:
    name: "220kV高压"
    category: "HV"
    plugins:
      transformer:
        detection_classes:
          - "oil_leak"
          - "rust"
          - "surface_damage"
          - "foreign_object"
          - "silica_gel_normal"
          - "silica_gel_abnormal"
          - "oil_level_normal"
          - "oil_level_abnormal"
        thermal_thresholds:
          normal: 60
          warning: 75
          alarm: 85
        data_sources:
          public: ["transformer_thermal", "ir_power_equipment", "substation_defect"]
          placeholder_required: false
          
      switch:
        detection_classes:
          - "breaker_open"
          - "breaker_closed"
          - "isolator_open"
          - "isolator_closed"
          - "grounding_open"
          - "grounding_closed"
          - "indicator_red"
          - "indicator_green"
        angle_reference:
          breaker: {open_deg: -55, closed_deg: 35}
          isolator: {open_deg: -65, closed_deg: 25}
          grounding: {open_deg: -75, closed_deg: 15}
        data_sources:
          public: ["substation_defect"]
          placeholder_required: false
          
      busbar:
        detection_classes:
          - "insulator_crack"
          - "insulator_dirty"
          - "fitting_loose"
          - "fitting_rust"
          - "wire_damage"
          - "foreign_object"
          - "bird"
          - "bird_nest"
        data_sources:
          public: ["insulator_defect", "cplid", "upid", "idid"]
          placeholder_required: false
          
      capacitor:
        detection_classes:
          - "capacitor_unit"
          - "capacitor_tilted"
          - "capacitor_fallen"
          - "capacitor_missing"
          - "person"
          - "vehicle"
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "倾斜和掉落数据需现场模拟"
          
      meter:
        detection_classes:
          - "sf6_pressure_gauge"
          - "oil_temp_gauge"
          - "oil_level_gauge"
        data_sources:
          public: ["ufpr_amr", "copel_amr"]
          placeholder_required: false

  HV_110kV:
    name: "110kV高压"
    category: "HV"
    plugins:
      transformer:
        detection_classes:
          - "oil_leak"
          - "rust"
          - "surface_damage"
          - "silica_gel_normal"
          - "silica_gel_abnormal"
          - "oil_level_normal"
          - "oil_level_abnormal"
        thermal_thresholds:
          normal: 55
          warning: 70
          alarm: 80
        data_sources:
          public: ["transformer_thermal", "substation_defect"]
          placeholder_required: false
          
      switch:
        detection_classes:
          - "breaker_open"
          - "breaker_closed"
          - "isolator_open"
          - "isolator_closed"
          - "grounding_open"
          - "grounding_closed"
          - "indicator_red"
          - "indicator_green"
        angle_reference:
          breaker: {open_deg: -55, closed_deg: 35}
          isolator: {open_deg: -65, closed_deg: 25}
          grounding: {open_deg: -75, closed_deg: 15}
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "不同型号断路器开合角度数据缺少"
          
      busbar:
        detection_classes:
          - "insulator_crack"
          - "insulator_dirty"
          - "fitting_loose"
          - "fitting_rust"
          - "wire_damage"
          - "foreign_object"
          - "bird"
          - "bird_nest"
        data_sources:
          public: ["insulator_defect", "cplid", "upid"]
          placeholder_required: false
          
      capacitor:
        detection_classes:
          - "capacitor_unit"
          - "capacitor_tilted"
          - "capacitor_fallen"
          - "person"
          - "vehicle"
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          
      meter:
        detection_classes:
          - "sf6_pressure_gauge"
          - "oil_temp_gauge"
          - "oil_level_gauge"
        data_sources:
          public: ["ufpr_amr"]
          placeholder_required: false

  # 中压 (MV)
  MV_35kV:
    name: "35kV中压"
    category: "MV"
    plugins:
      transformer:
        detection_classes:
          - "oil_leak"
          - "rust"
          - "silica_gel_normal"
          - "silica_gel_abnormal"
          - "oil_level_normal"
          - "oil_level_abnormal"
          - "conductor_rust"
        thermal_thresholds:
          normal: 50
          warning: 65
          alarm: 75
        data_sources:
          public: ["transformer_thermal"]
          placeholder_required: true
          placeholder_reason: "需采集站内导电接头锈蚀和油渍图像"
          
      switch:
        detection_classes:
          - "breaker_open"
          - "breaker_closed"
          - "isolator_open"
          - "isolator_closed"
          - "indicator_red"
          - "indicator_green"
          - "cabinet_door"
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "中压开关结构型号较多"
          
      busbar:
        detection_classes:
          - "insulator_crack"
          - "insulator_dirty"
          - "fitting_loose"
          - "wire_damage"
          - "foreign_object"
        data_sources:
          public: ["insulator_defect", "cplid"]
          placeholder_required: true
          placeholder_reason: "导线紧固件松动和异物缠绕数据"
          
      capacitor:
        detection_classes:
          - "capacitor_unit"
          - "capacitor_tilted"
          - "capacitor_missing"
          - "safety_distance"
        data_sources:
          public: []
          placeholder_required: true
          placeholder_reason: "暂无公开数据，需现场采集"
          
      meter:
        detection_classes:
          - "digital_meter"
          - "analog_meter"
          - "transformer_monitor"
        data_sources:
          public: ["ufpr_amr", "copel_amr"]
          placeholder_required: true
          placeholder_reason: "电表遮挡、污渍样本需现场采集"

  # 低压 (LV)
  LV_10kV:
    name: "10kV低压"
    category: "LV"
    plugins:
      transformer:
        detection_classes:
          - "rust"
          - "oil_leak"
          - "radiator_damage"
          - "box_transformer"
        thermal_thresholds:
          normal: 45
          warning: 60
          alarm: 70
        data_sources:
          public: ["transformer_thermal", "substation_defect"]
          placeholder_required: true
          placeholder_reason: "现场低压箱变故障图像"
          
      switch:
        detection_classes:
          - "cabinet_switch"
          - "air_breaker"
          - "indicator_light"
          - "label"
        data_sources:
          public: ["substation_defect"]
          placeholder_required: true
          placeholder_reason: "标签老化和模糊样本"
          
      busbar:
        detection_classes:
          - "bolt_loose"
          - "wire_damage"
          - "foreign_object"
        data_sources:
          public: ["insulator_defect"]
          placeholder_required: true
          placeholder_reason: "螺栓松动近景照片"
          
      capacitor:
        detection_classes:
          - "capacitor_bulge"
          - "capacitor_leak"
        data_sources:
          public: []
          placeholder_required: true
          placeholder_reason: "鼓包和漏液样本需现场采集"
          
      meter:
        detection_classes:
          - "energy_meter"
          - "water_meter"
          - "pointer_meter"
          - "digital_meter"
        data_sources:
          public: ["ufpr_amr", "copel_amr"]
          placeholder_required: true
          placeholder_reason: "老旧表和污染表图片"

# =============================================================================
# 训练超参数配置
# =============================================================================
training:
  # 默认训练参数
  default:
    epochs: 100
    batch_size: 16
    learning_rate: 0.001
    weight_decay: 0.0005
    momentum: 0.937
    warmup_epochs: 3
    img_size: 640
    optimizer: "AdamW"
    scheduler: "cosine"
    
  # 按设备类型的特殊配置
  plugin_specific:
    transformer:
      epochs: 150
      batch_size: 8
      img_size: 1280  # 大目标需要更高分辨率
      
    switch:
      epochs: 100
      batch_size: 16
      img_size: 640
      
    busbar:
      epochs: 120
      batch_size: 16
      img_size: 1280  # 小目标检测
      
    capacitor:
      epochs: 80
      batch_size: 16
      img_size: 640
      
    meter:
      epochs: 100
      batch_size: 32  # OCR任务可以用更大batch
      img_size: 416

  # 数据增强配置
  augmentation:
    hsv_h: 0.015
    hsv_s: 0.7
    hsv_v: 0.4
    degrees: 10
    translate: 0.1
    scale: 0.5
    shear: 2.0
    flipud: 0.5
    fliplr: 0.5
    mosaic: 1.0
    mixup: 0.1
    
  # Few-shot学习配置
  few_shot:
    enabled: true
    support_set_size: 5
    query_set_size: 15
    episodes: 1000
    meta_lr: 0.001

# =============================================================================
# 模型配置
# =============================================================================
models:
  backbone:
    default: "yolov8m"
    options: ["yolov8n", "yolov8s", "yolov8m", "yolov8l", "yolov8x"]
    
  # 按电压等级推荐的模型
  voltage_model_mapping:
    UHV: "yolov8l"      # 特高压：大模型，高精度
    EHV: "yolov8m"      # 超高压：中等模型
    HV: "yolov8m"       # 高压：中等模型
    MV: "yolov8s"       # 中压：轻量模型
    LV: "yolov8n"       # 低压：最轻量模型

# =============================================================================
# 输出格式配置
# =============================================================================
export:
  formats: ["onnx", "torchscript", "coreml"]
  onnx:
    opset: 12
    simplify: true
    dynamic: true
  tensorrt:
    fp16: true
    int8: false
