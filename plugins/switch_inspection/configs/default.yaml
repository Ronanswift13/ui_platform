# ============================================================
# 开关间隔自主巡视插件配置 (B组)
# 输变电激光星芒破夜绘明监测平台
# 版本: 1.0.0
# ============================================================

# 模型配置
model:
  path: "models/switch_detector.onnx"
  device: "cpu"   # cpu/cuda

# 推理配置 - 按性能指标标定
inference:
  confidence_threshold: 0.6    # 置信度阈值
  nms_threshold: 0.4           # NMS阈值
  max_detections: 50           # 最大检测数

# 状态识别配置 - 按性能指标标定
state_recognition:
  min_state_score: 0.55        # 最小状态评分

  # 多证据融合权重
  fusion_weights:
    text: 0.5                  # OCR文字权重
    color: 0.3                 # 颜色提示权重
    angle: 0.2                 # 角度检测权重

  angle_sigma_deg: 18          # 角度判定容差(度)

  # 每类开关的标定参考角(度) - 需按点位标定
  angle_reference:
    breaker:
      open_deg: -60            # 断路器分位角度
      closed_deg: 30           # 断路器合位角度
    isolator:
      open_deg: -70            # 隔离开关分位角度
      closed_deg: 20           # 隔离开关合位角度
    grounding:
      open_deg: -80            # 接地开关分位角度
      closed_deg: 10           # 接地开关合位角度

  # OCR配置
  ocr:
    enabled: true
    engine: "easyocr"          # 或 paddleocr, tesseract
    keywords_open: ["分", "OPEN", "OFF", "断开"]
    keywords_closed: ["合", "CLOSE", "ON", "闭合"]

  # 颜色提示配置
  color_hint:
    enabled: true
    # 绿色HSV范围(表示合闸)
    hsv_green: [[35, 40, 40], [85, 255, 255]]
    # 红色HSV范围(表示分闸)
    hsv_red1:  [[0, 60, 60], [10, 255, 255]]
    hsv_red2:  [[170, 60, 60], [180, 255, 255]]

# 逻辑校验配置 - 五防互锁规则
logic_validation:
  enabled: true
  rules:
    - name: "防止带电合接地刀"
      condition: "isolator_open_before_grounding"
      severity: "error"
    - name: "防止带接地刀合隔离开关"
      condition: "grounding_open_before_isolator"
      severity: "error"
    - name: "异常工况提示：合闸但刀闸断开"
      condition: "breaker_closed_while_isolator_open"
      severity: "warning"

# 图像质量评价配置 - 清晰度评分
image_quality:
  enabled: true
  method: "laplacian_var"      # laplacian_var, sobel, fft
  mu: 120                      # 拉普拉斯方差期望值
  tau: 30                      # 置信区间参数
  min_clarity_score: 0.70      # 最小清晰度分数

# 调焦联动配置
focus_link:
  stable_iou_threshold: 0.70   # 稳定IoU阈值
  stable_frames: 3             # 稳定帧数

# SF6表计读数配置(可选)
gauge_reading:
  enabled: false
  pointer:
    theta_min_deg: -120        # 指针最小角度
    theta_max_deg: 120         # 指针最大角度
    value_min: 0.0             # 对应最小读数
    value_max: 1.0             # 对应最大读数
    unit: "MPa"                # 单位

# 设备类型列表
device_types: ["breaker", "isolator", "grounding"]

# ROI类型映射
roi_types:
  breaker_indicator: "断路器指示窗"
  isolator_indicator: "隔离开关指示窗"
  grounding_indicator: "接地开关指示窗"
  breaker_linkage: "断路器连杆"
  isolator_linkage: "隔离刀闸连杆"
  grounding_handle: "接地柄"
  gauge_pressure: "SF6压强表"
  gauge_density: "SF6密度表"
  mechanism_box: "机构箱"
  arrester: "避雷器"
  clarity_anchor: "清晰度锚点"

# 性能指标(验收标准)
performance:
  # 单帧单ROI处理时间(1080p ROI裁剪后)
  max_inference_time_ms: 300
  # 状态识别准确率(同点位固定ROI)
  state_accuracy: 0.95
  # 逻辑校验误报率
  logic_false_positive: 0.02

# 失败原因码定义
reason_codes:
  1001: "清晰度过低"
  1002: "OCR失败或无文本"
  1003: "未检测到有效角度/线段"
  1004: "表盘/指针检测失败"
  2001: "互锁逻辑异常(带电合接地刀风险)"
  2002: "异常工况提示"
  9000: "未知错误"
