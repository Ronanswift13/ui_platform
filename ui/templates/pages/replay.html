{% extends "base.html" %}

{% block title %}回放 - 输变电监测平台{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- 回放预览 -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-play-circle"></i> 回放预览</h5>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" id="btn-prev">
                        <i class="bi bi-skip-backward"></i>
                    </button>
                    <button class="btn btn-primary" id="btn-play">
                        <i class="bi bi-play-fill"></i>
                    </button>
                    <button class="btn btn-outline-primary" id="btn-next">
                        <i class="bi bi-skip-forward"></i>
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="video-container" style="min-height: 480px; background: #1a1a1a;">
                    <div class="text-center text-white py-5">
                        <i class="bi bi-film" style="font-size: 4rem;"></i>
                        <p class="mt-3">请选择回放记录</p>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <input type="range" class="form-range" id="timeline" value="0" min="0" max="100">
                <div class="d-flex justify-content-between">
                    <small id="current-time">00:00</small>
                    <small id="total-time">00:00</small>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- 回放记录列表 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> 回放记录</h5>
            </div>
            <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                <div class="list-group list-group-flush" id="replay-list">
                    <div class="text-center text-muted py-4">
                        <div class="spinner-border spinner-border-sm"></div>
                        <p class="mb-0 mt-2">加载中...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadReplayRuns();
});

function loadReplayRuns() {
    fetch('/api/evidence/runs?limit=50')
        .then(r => r.json())
        .then(data => {
            const list = document.getElementById('replay-list');
            if (data.length === 0) {
                list.innerHTML = '<div class="text-center text-muted py-4">暂无回放记录</div>';
                return;
            }
            list.innerHTML = data.map(run => `
                <a href="#" class="list-group-item list-group-item-action" onclick="loadReplay('${run.run_id}')">
                    <div class="d-flex justify-content-between">
                        <strong>${run.plugin_id}</strong>
                        <span class="badge bg-${run.success ? 'success' : 'danger'}">${run.success ? '成功' : '失败'}</span>
                    </div>
                    <small class="text-muted">${run.started_at}</small>
                </a>
            `).join('');
        })
        .catch(err => {
            document.getElementById('replay-list').innerHTML = '<div class="text-center text-danger py-4">加载失败</div>';
        });
}

function loadReplay(runId) {
    console.log('加载回放:', runId);
    // TODO: 实现回放加载逻辑
}
</script>
{% endblock %}
